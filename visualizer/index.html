<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VaporVU Visualizer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        neon: {
                            pink: '#ff6ad5',
                            purple: '#a86af7',
                            cyan: '#5af8ff',
                            blue: '#5aa9ff',
                        },
                    },
                },
            },
        }
    </script>
    <link rel="stylesheet" href="styles.css" />
</head>

<body class="min-h-dvh bg-[#0b0d10] text-white font-['Plus_Jakarta_Sans',system-ui] overflow-hidden">
    <!-- Background vapor gradients -->
    <div class="pointer-events-none fixed inset-0 -z-10">
        <div
            class="absolute -top-24 -right-24 h-[28rem] w-[28rem] rounded-full bg-gradient-to-br from-neon.purple/30 to-neon.cyan/30 blur-3xl">
        </div>
        <div
            class="absolute top-1/3 -left-24 h-[40rem] w-[40rem] rounded-full bg-gradient-to-tr from-neon.pink/25 to-neon.blue/25 blur-[110px]">
        </div>
        <div
            class="absolute bottom-0 right-1/4 h-96 w-96 rounded-full bg-gradient-to-tr from-white/10 to-transparent blur-3xl">
        </div>
    </div>

    <header class="relative z-10 flex items-center justify-between gap-4 px-4 py-3 sm:px-6">
        <div class="flex items-center gap-3">
            <div class="h-8 w-8 rounded-lg bg-gradient-to-br from-neon.pink to-neon.cyan"></div>
            <div class="text-lg font-semibold tracking-wide">VaporVU</div>
        </div>
        <div class="flex items-center gap-2 text-xs text-white/60">
            <button id="camera-toggle"
                class="rounded-md border border-white/10 bg-white/10 px-2 py-1 text-xs hover:bg-white/20">üì∑</button>
            <button id="options-toggle"
                class="rounded-md border border-white/10 bg-white/10 px-2 py-1 text-xs hover:bg-white/20">‚öô</button>
            <button id="playlist-toggle"
                class="rounded-md border border-white/10 bg-white/10 px-3 py-1 text-xs hover:bg-white/20">Playlist</button>
        </div>
    </header>

    <main class="relative z-0 grid h-[calc(100dvh-56px)] grid-rows-[1fr_auto]">
        <!-- Scene container -->
        <section class="relative">
            <canvas id="three-canvas" class="absolute inset-0 h-full w-full"></canvas>

            <!-- Removed global dropzone; drop is handled in the playlist drawer region -->

            <!-- Minimal HUD (now-playing only) -->
            <div
                class="absolute left-3 top-3 flex items-center gap-3 rounded-lg bg-black/30 px-3 py-2 text-xs backdrop-blur-md ring-1 ring-white/10">
                <div id="now-playing" class="max-w-[50vw] truncate">No track loaded</div>
            </div>
        </section>

        <!-- Player + Playlist -->
        <section
            class="relative grid gap-3 bg-black/30 p-3 backdrop-blur-xl ring-1 ring-white/10 sm:grid-cols-[1fr_auto] sm:items-center">
            <!-- Controls -->
            <div class="flex items-center gap-3">
                <button id="prev-btn" class="control-btn" title="Previous">‚èÆ</button>
                <button id="play-btn" class="control-btn" title="Play/Pause">‚èµ</button>
                <button id="next-btn" class="control-btn" title="Next">‚è≠</button>

                <input id="seek" type="range" min="0" max="100" value="0" class="seek" />
                <div id="time" class="w-28 text-right text-xs tabular-nums">00:00 / 00:00</div>

                <input id="volume" type="range" min="0" max="1" step="0.01" value="0.9" class="volume" title="Volume" />
            </div>

            <!-- Playlist -->
            <div class="flex min-w-0 items-center gap-2 overflow-x-auto"></div>
        </section>
    </main>

    <audio id="audio" crossorigin="anonymous"></audio>

    <!-- Center toast for camera view name -->
    <div id="camera-toast"
        class="pointer-events-none fixed inset-0 z-[60] grid place-items-center opacity-0 transition-opacity duration-700">
        <div id="camera-toast-text" class="rounded-lg bg-black/60 px-4 py-2 text-sm ring-1 ring-white/10">Camera</div>
    </div>

    <!-- Left options drawer -->
    <div id="options-overlay" class="fixed inset-0 z-40 hidden bg-black/50"></div>
    <aside id="options-drawer"
        class="fixed left-0 top-0 z-50 h-full w-72 max-w-[90vw] -translate-x-full border-r border-white/10 bg-[#0b0d10]/95 backdrop-blur-xl transition-transform">
        <div class="flex items-center justify-between border-b border-white/10 px-4 py-3">
            <h3 class="text-sm font-semibold">Options</h3>
            <button id="options-close" class="control-btn">‚úï</button>
        </div>
        <div class="p-4 grid gap-3 text-xs">
            <label class="flex items-center justify-between gap-3">
                <span>Trails</span>
                <input id="toggle-afterimage" type="checkbox" class="accent-white" />
            </label>
            <label class="flex items-center justify-between gap-3">
                <span>Bloom</span>
                <input id="toggle-bloom" type="checkbox" class="accent-white" />
            </label>
            <div class="grid gap-1">
                <span>Camera</span>
                <select id="camera-mode"
                    class="rounded-md bg-black/40 text-white text-xs border border-white/10 px-2 py-1">
                    <option value="orbit">Orbit</option>
                    <option value="follow">Follow</option>
                    <option value="center">Center Up</option>
                    <option value="user">User</option>
                </select>
            </div>
        </div>
    </aside>

    <!-- Center toast for camera view name -->
    <div id="camera-toast"
        class="pointer-events-none fixed inset-0 z-[60] grid place-items-center opacity-0 transition-opacity duration-700">
        <div id="camera-toast-text" class="rounded-lg bg-black/60 px-4 py-2 text-sm ring-1 ring-white/10">Camera</div>
    </div>

    <!-- Bottom-right camera HUD -->
    <div id="camera-hud"
        class="pointer-events-auto fixed bottom-24 right-3 z-[55] rounded bg-black/40 px-2 py-1 text-[11px] text-white/60 ring-1 ring-white/10 cursor-pointer">
        Pos: 0,0,0 | Yaw: 0¬∞ | Pitch: 0¬∞
    </div>

    <!-- Right playlist drawer -->
    <div id="playlist-overlay" class="fixed inset-0 z-40 hidden bg-black/50"></div>
    <aside id="playlist-drawer"
        class="fixed right-0 top-0 z-50 h-full w-80 max-w-[90vw] translate-x-full border-l border-white/10 bg-[#0b0d10]/95 backdrop-blur-xl transition-transform">
        <div class="flex items-center justify-between border-b border-white/10 px-4 py-3">
            <h3 class="text-sm font-semibold">Playlist</h3>
            <button id="playlist-close" class="control-btn">‚úï</button>
        </div>
        <div id="playlist-dropzone" class="relative grid h-[calc(100%-48px)] grid-rows-[auto_1fr_auto]">
            <div class="flex items-center gap-2 p-3">
                <button id="browse-btn"
                    class="rounded-md border border-white/10 bg-white/10 px-3 py-2 text-xs hover:bg-white/20">Browse
                    files</button>
                <input id="file-input" type="file" accept=".flac,.wav,.mp3,.m4a" multiple class="hidden" />
            </div>
            <ul id="playlist" class="overflow-y-auto p-3 space-y-1"></ul>
            <div id="drawer-drop-hint"
                class="pointer-events-none absolute inset-0 hidden place-items-center rounded-none border-2 border-dashed border-white/30 bg-black/40 backdrop-blur-md">
                <div class="pointer-events-none grid place-items-center gap-2 p-6 text-center">
                    <div class="text-lg font-semibold">Drop audio files</div>
                    <div class="text-white/70">Add tracks to this playlist</div>
                </div>
            </div>
        </div>
    </aside>

    <script type="module" src="/app.js"></script>
</body>

</html>